services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      no_cache: false
    image: bitcoin-web-api
    container_name: bitcoin-web-api
    ports:
      - 8080:8080
    environment:
      ASPNETCORE_ENVIRONMENT: $ASPNETCORE_ENVIRONMENT
      ASPNETCORE_HTTP_PORTS: $ASPNETCORE_HTTP_PORTS
      KEY_VAULT_NAME: $KEY_VAULT_NAME
      USE_OUTPUT_CACHE: $USE_OUTPUT_CACHE
      USE_JSON_FORMATTING: $USE_JSON_FORMATTING
      USE_MOCKING: $USE_MOCKING
      SHOW_MOCKING_LOGS: $SHOW_MOCKING_LOGS
      MARKET_CLIENT_URL: http://wiremock:8080
    user: app
    read_only: true
    privileged: false
    tmpfs:
      - /tmp:rw
  wiremock:
    image: wiremock/wiremock:3.13.1-alpine
    container_name: wiremock
    ports:
      - 9091:8080
    read_only: false
    privileged: true
    volumes:
      - ./wiremock:/home/wiremock/mappings
